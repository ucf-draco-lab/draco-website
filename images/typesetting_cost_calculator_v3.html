<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ASEE CoED Cost Estimator</title>
  <style>
    :root { 
      --bg:#0b0c10; 
      --card:#12141a; 
      --text:#e8e8e8; 
      --muted:#a9b0b8; 
      --accent:#ffd166; 
      --ok:#06d6a0; 
      --bad:#ef476f; 
      --highlight:#45a29e;
      --border: #2a2f42;
    }
    *{ box-sizing:border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:linear-gradient(180deg, #0b0c10 0%, #101218 100%); color:var(--text); }
    .wrap { max-width: 980px; margin: 40px auto; padding: 24px; }
    .card { background: var(--card); border:1px solid #1e2230; border-radius: 16px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { font-size: 1.6rem; margin: 0 0 12px; }
    p.lead { color: var(--muted); margin-top: 0; }
    
    .grid { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 16px; }
    
    label { display:block; font-size: .9rem; color: var(--muted); margin-bottom: 6px; }
    input[type="number"] { width:100%; padding:10px 12px; border-radius: 10px; border:1px solid var(--border); background:#0f1219; color:var(--text); }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin:0; }
    
    .row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
    
    /* Membership Section styles */
    .membership-box { background: #181c25; border: 1px solid var(--border); padding: 16px; border-radius: 12px; margin-top: 16px; }
    .checkbox-group { display:flex; flex-direction: column; gap: 10px; }
    .checkbox-item { display:flex; align-items:center; gap: 8px; cursor: pointer; user-select: none; width: fit-content;}
    .checkbox-item input { width: 18px; height: 18px; accent-color: var(--highlight); cursor: pointer; }
    .checkbox-item.disabled { opacity: 0.5; cursor: not-allowed; }
    .checkbox-item.disabled input { cursor: not-allowed; }
    
    .nested { margin-left: 28px; position: relative; }
    .nested::before { content:'L'; position: absolute; left: -18px; top: -6px; color: var(--muted); opacity: 0.5; transform: scaleY(-1) rotate(180deg); }

    .discount-tag { font-size: 0.75rem; background: var(--ok); color: #000; padding: 2px 6px; border-radius: 4px; font-weight: 700; margin-left: 6px; }

    button { background:#1b2030; color:var(--text); border:1px solid var(--border); padding:10px 14px; border-radius: 10px; cursor:pointer; }
    button.primary{ background: var(--accent); color:#191919; border-color:#e7be57; font-weight:600; }
    button.ghost{ background: transparent; }
    button:active{ transform: translateY(1px); }
    
    .totals { margin-top:20px; display:grid; grid-template-columns: repeat(4, 1fr); gap:12px; }
    .pill { background:#0f1219; border:1px solid var(--border); padding:12px 14px; border-radius: 12px; display:flex; flex-direction: column; justify-content: space-between; }
    .pill span.muted { font-size: 0.85rem; margin-bottom: 4px; display:block;}
    .pill strong { font-size:1.2rem; color:var(--text); }
    .pill.total { border-color: var(--accent); background: rgba(255, 209, 102, 0.05); }
    .pill.total strong { color: var(--accent); }
    
    .sub-totals { margin-top: 12px; display: flex; gap: 16px; font-size: 0.85rem; color: var(--muted); border-top: 1px solid #22283b; padding-top: 12px; }
    .sub-val { color: var(--text); font-weight: 600; margin-left: 4px; }

    .muted { color: var(--muted); }
    .footer { margin-top: 18px; color: var(--muted); font-size: .85rem; line-height: 1.5; }
    .hr { height:1px; background:#21263a; margin:24px 0; border-radius: 1px; }
    .warn { color: var(--bad); font-size: .9rem; }
    .right { text-align:right; }
    
    /* Matrix Table Styles */
    .table-container { overflow-x: auto; }
    .matrix-table { width:100%; border-collapse: separate; border-spacing: 4px; margin-top: 10px; }
    .matrix-table th, .matrix-table td { padding: 12px; text-align: center; border-radius: 8px; }
    
    .matrix-table th { background: #1b2030; color: var(--muted); font-weight: 600; font-size: 0.9rem; vertical-align: bottom;}
    .matrix-table th small { display: block; font-weight: 400; font-size: 0.75rem; margin-top: 4px; opacity: 0.7; }
    
    .matrix-table td { background: #0f1219; border: 1px solid var(--border); transition: 0.2s; }
    .matrix-table td strong { color: var(--accent); display: block; font-size: 1.05rem; }
    
    .matrix-table td.current-cell { border: 1px solid var(--highlight); background: rgba(69, 162, 158, 0.1); position: relative; }
    .matrix-table td.current-cell::after { content: 'Current'; position: absolute; top: -8px; right: -8px; background: var(--highlight); color: #000; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; }

    .row-header { text-align: left !important; background: transparent !important; color: var(--text); font-weight: 600; width: 120px; }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .totals { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ASEE CoED Publishing Cost Estimator</h1>
      <p class="lead">Typesetting: <span class="tag">≈$10 / 500 words</span> · <span class="tag">≈$10 / figure/table</span> · <span class="tag">≈$8 / block equation</span></p>

      <div class="grid" style="margin-top:12px">
        <div>
          <label for="wordCount">Word Count (increment:1000)</label>
          <input type="number" id="wordCount" min="0" step="1000" value="5000" />
        </div>
        <div>
          <label for="figures">Figures/Tables</label>
          <input type="number" id="figures" min="0" step="1" value="6" />
        </div>
        <div>
          <label for="equations">Block Equations</label>
          <input type="number" id="equations" min="0" step="1" value="4" />
        </div>
      </div>

      <div class="membership-box">
        <label style="margin-bottom:8px; display:block; color:var(--accent);">Membership Discounts</label>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" id="checkASEE" />
            <span>ASEE Member</span>
            <span class="discount-tag">-$50</span>
          </label>
          
          <label class="checkbox-item nested" id="coedLabel">
            <input type="checkbox" id="checkCoED" disabled />
            <span>CoED Division Member</span>
            <span class="discount-tag">-$25</span>
          </label>
        </div>
        <div style="margin-top:8px; font-size:0.8rem; color:var(--muted); font-style:italic;">
          * CoED discount is only available to ASEE members.
        </div>
      </div>

      <div class="row" style="margin-top:16px">
        <button class="primary" id="calcBtn">Calculate Total</button>
        <button class="ghost" id="resetBtn" title="Reset inputs to defaults">Reset</button>
        <span id="msg" class="warn" role="status" aria-live="polite"></span>
      </div>

      <div class="totals">
        <div class="pill">
          <span class="muted">Base Publication Fee</span>
          <strong>$350.00</strong>
        </div>
        <div class="pill">
          <span class="muted">Total Discounts</span>
          <strong id="dispDiscount" style="color:var(--ok)">$0.00</strong>
        </div>
        <div class="pill">
          <span class="muted">Net Typesetting Cost <br><span style="font-size:0.7em; opacity:0.7">(Rounded up to $10)</span></span>
          <strong id="dispTypeset">≈ $0</strong>
        </div>
        <div class="pill total">
          <span class="muted">Total Estimated Cost</span>
          <strong id="dispTotal">≈ $350</strong>
        </div>
      </div>

      <div class="sub-totals">
        <span>Typesetting Breakdown:</span>
        <span>Words: <span id="breakWords" class="sub-val">$0</span></span> •
        <span>Figures: <span id="breakFigs" class="sub-val">$0</span></span> •
        <span>Equations: <span id="breakEqs" class="sub-val">$0</span></span> •
        <span>Credit: <span class="sub-val credit">-$150</span></span>
      </div>

      <div class="hr"></div>

      <div style="margin-top:12px">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <h2 style="margin:0; font-size:1.1rem;">Cost Forecast Matrix</h2>
          <span class="muted">Total Cost (Base + Typeset - Discounts)</span>
        </div>
        
        <p style="font-size:0.85rem; color:var(--muted); margin-top:4px;">
          Rows show word count variations. Columns show complexity (Figures + Equations).
        </p>

        <div class="table-container">
          <table class="matrix-table" id="forecastMatrix">
            <thead>
              <tr>
                <th></th> <th>Low Complexity<br><small id="headLow">(-50% Figs/Eqs)</small></th>
                <th>Current Inputs<br><small id="headMed">(Current Figs/Eqs)</small></th>
                <th>High Complexity<br><small id="headHigh">(+50% Figs/Eqs)</small></th>
              </tr>
            </thead>
            <tbody>
              </tbody>
          </table>
        </div>
      </div>

      <div class="footer">
        <div><strong>Calculation Rule:</strong> Total Cost = (Exact Base Fee − Discounts) + (Rounded Net Typesetting). <br>Note: Only the typesetting portion is rounded up to the nearest $10.</div>
      </div>
    </div>
  </div>

  <script>
    // --- Constants ---
    const PRICE_PER_500 = 10;
    const PRICE_PER_FIG = 10;
    const PRICE_PER_EQ = 8; 

    const BASE_FEE = 350;
    const DISCOUNT_ASEE_VAL = 50;
    const DISCOUNT_COED_VAL = 25;
    const JOURNAL_CREDIT = 150;

    // --- DOM Elements ---
    const wordEl = document.getElementById('wordCount');
    const figEl = document.getElementById('figures');
    const eqEl = document.getElementById('equations');
    const msgEl = document.getElementById('msg');
    
    // Membership
    const checkASEE = document.getElementById('checkASEE');
    const checkCoED = document.getElementById('checkCoED');
    const coedLabel = document.getElementById('coedLabel');

    // Display Elements
    const dispDiscount = document.getElementById('dispDiscount');
    const dispTypeset = document.getElementById('dispTypeset');
    const dispTotal = document.getElementById('dispTotal');
    const breakWords = document.getElementById('breakWords');
    const breakFigs = document.getElementById('breakFigs');
    const breakEqs = document.getElementById('breakEqs');

    // Matrix Headers
    const headLow = document.getElementById('headLow');
    const headMed = document.getElementById('headMed');
    const headHigh = document.getElementById('headHigh');
    const matrixBody = document.querySelector('#forecastMatrix tbody');

    // --- Helpers ---
    function ceilTo10(n){ return Math.ceil(n / 10) * 10; }
    function approx(n){ return '≈ $' + n.toLocaleString(); } 

    function validateInputs(){
      const wc = Number(wordEl.value) || 0;
      const figs = Number(figEl.value) || 0;
      const eqs = Number(eqEl.value) || 0;
      let ok = true;
      msgEl.textContent = '';

      if (wc < 0 || figs < 0 || eqs < 0){
        msgEl.textContent = 'Values cannot be negative.';
        ok = false;
      }
      if (wc % 1000 !== 0){
        msgEl.textContent = 'Word count must be in increments of 1000.';
        ok = false;
      }
      return ok;
    }

    // --- Membership Logic ---
    function updateMembershipState() {
      if (checkASEE.checked) {
        checkCoED.disabled = false;
        coedLabel.classList.remove('disabled');
      } else {
        checkCoED.disabled = true;
        checkCoED.checked = false; // Reset CoED if ASEE is unchecked
        coedLabel.classList.add('disabled');
      }
      renderTotals();
      renderForecast();
    }

    // --- Calculation Logic ---
    function getDiscountAmount() {
      let d = 0;
      if (checkASEE.checked) d += DISCOUNT_ASEE_VAL;
      if (checkCoED.checked && !checkCoED.disabled) d += DISCOUNT_COED_VAL;
      return d;
    }

    function calculateFinancials(words, figs, eqs, discountAmt){
      const wordCost = (words / 500) * PRICE_PER_500;
      const figCost = figs * PRICE_PER_FIG;
      const eqCost = eqs * PRICE_PER_EQ;
      
      const typesetRaw = wordCost + figCost + eqCost;
      
      // Credit applied to raw typesetting
      const typesetNet = Math.max(0, typesetRaw - JOURNAL_CREDIT);
      
      // ROUNDING FIX: Round the variable (typesetting) cost immediately
      const typesetRounded = ceilTo10(typesetNet);

      // Base Cost is exact (Base - Discount)
      const baseNet = Math.max(0, BASE_FEE - discountAmt);
      
      // Total is Base(Exact) + Typeset(Rounded)
      const grandTotal = baseNet + typesetRounded;

      return { wordCost, figCost, eqCost, typesetRounded, grandTotal };
    }

    // --- Forecast Logic ---
    function getLevels(val){
      const low = Math.max(0, Math.floor(val * 0.5));
      const med = Math.max(0, Math.floor(val));
      const high = Math.max(0, Math.ceil(val * 1.5));
      if(val === 0) return [0, 2, 4]; 
      let set = Array.from(new Set([low, med, high])).sort((a,b)=>a-b);
      while(set.length < 3) set.push(set[set.length-1] + 1);
      return set.slice(0,3);
    }

    function getWordLevels(val){
      const step = 1000;
      const low = Math.max(0, Math.floor((val * 0.5) / step) * step);
      const med = Math.floor(val / step) * step;
      const high = Math.max(step, Math.ceil((val * 1.5) / step) * step);
      let set = Array.from(new Set([low, med, high])).sort((a,b)=>a-b);
      if (set.length < 3) {
        if (!set.includes(0)) set.unshift(0);
        while (set.length < 3) set.push((set[set.length-1] || 0) + step);
      }
      return set.slice(0,3);
    }

    // --- Rendering ---
    function renderTotals(){
      if(!validateInputs()) return;

      const wc = Number(wordEl.value) || 0;
      const figs = Number(figEl.value) || 0;
      const eqs = Number(eqEl.value) || 0;
      const discount = getDiscountAmount();

      const fin = calculateFinancials(wc, figs, eqs, discount);

      dispDiscount.textContent = discount > 0 ? `-$${discount.toFixed(2)}` : '$0.00';
      
      // Display rounded typesetting
      dispTypeset.textContent = approx(fin.typesetRounded);
      
      // Display total (which is Base + Rounded Typesetting)
      dispTotal.textContent = approx(fin.grandTotal);

      breakWords.textContent = '$' + fin.wordCost.toFixed(0);
      breakFigs.textContent = '$' + fin.figCost.toFixed(0);
      breakEqs.textContent = '$' + fin.eqCost.toFixed(0);
    }

    function renderForecast(){
      const wc = Number(wordEl.value) || 0;
      const fc = Number(figEl.value) || 0;
      const ec = Number(eqEl.value) || 0;
      const discount = getDiscountAmount();

      const wLevels = getWordLevels(wc);
      const fLevels = getLevels(fc);
      const eLevels = getLevels(ec);

      headLow.textContent = `(${fLevels[0]} Figs, ${eLevels[0]} Eqs)`;
      headMed.textContent = `(${fLevels[1]} Figs, ${eLevels[1]} Eqs)`;
      headHigh.textContent = `(${fLevels[2]} Figs, ${eLevels[2]} Eqs)`;

      let html = '';

      wLevels.forEach((w, index) => {
        let label = (index === 0) ? 'Low Words' : (index === 1) ? 'Current Words' : 'High Words';
        let sub = w.toLocaleString();

        let rowHtml = `<tr><td class="row-header">${label}<br><small style="font-weight:400; opacity:0.7">${sub}</small></td>`;
        
        for(let i=0; i<3; i++){
          const f = fLevels[i];
          const e = eLevels[i];
          const { grandTotal } = calculateFinancials(w, f, e, discount);
          
          const isCenter = (index === 1 && i === 1);
          const cellClass = isCenter ? 'current-cell' : '';
          
          rowHtml += `<td class="${cellClass}"><strong>${approx(grandTotal)}</strong></td>`;
        }
        rowHtml += '</tr>';
        html += rowHtml;
      });

      matrixBody.innerHTML = html;
    }

    function resetInputs(){
      wordEl.value = 5000;
      figEl.value = 6;
      eqEl.value = 4;
      checkASEE.checked = false;
      updateMembershipState();
      msgEl.textContent = '';
      renderTotals();
      renderForecast();
    }

    // --- Events ---
    document.getElementById('calcBtn').addEventListener('click', () => { renderTotals(); renderForecast(); });
    document.getElementById('resetBtn').addEventListener('click', resetInputs);
    
    checkASEE.addEventListener('change', updateMembershipState);

    const inputs = [wordEl, figEl, eqEl, checkCoED];
    inputs.forEach(el => {
      el.addEventListener('input', () => { renderTotals(); renderForecast(); });
      el.addEventListener('change', () => { renderTotals(); renderForecast(); });
    });

    // Init
    resetInputs();
  </script>
</body>
</html>
